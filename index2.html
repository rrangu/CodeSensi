<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial AI Analysis Platform</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e27;
            --bg-secondary: #141932;
            --bg-tertiary: #1e2540;
            --text-primary: #e4e7f0;
            --text-secondary: #9ca3af;
            --accent-bullish: #10b981;
            --accent-bearish: #ef4444;
            --accent-neutral: #3b82f6;
            --border-color: #2d3548;
        }

        body {
            font-family: 'Inter', 'Roboto', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 2rem;
            z-index: 1000;
            gap: 2rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-bullish), var(--accent-neutral));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            white-space: nowrap;
        }

        .search-bar {
            flex: 1;
            max-width: 500px;
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: all 0.3s;
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--accent-neutral);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .autocomplete {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-top: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .autocomplete.active {
            display: block;
        }

        .autocomplete-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .autocomplete-item:hover {
            background: var(--bg-secondary);
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .icon-btn:hover {
            background: var(--bg-primary);
            border-color: var(--accent-neutral);
        }

        /* --- SIDEBAR REMOVED --- */

        /* Main Content */
        .main-content {
            /* --- margin-left REMOVED --- */
            margin-top: 70px;
            padding: 2rem;
            min-height: calc(100vh - 70px);
        }

        /* Stock Info Banner */
        .stock-banner {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .stock-info-main {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .stock-info {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .stock-symbol {
            font-size: 2rem;
            font-weight: 700;
        }

        .stock-price {
            font-size: 2rem;
            font-weight: 600;
            color: var(--accent-bullish);
        }

        .stock-change {
            font-size: 1.1rem;
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            background: rgba(16, 185, 129, 0.1);
            color: var(--accent-bullish);
        }

        /* --- NEW PORTFOLIO BUTTON --- */
        .portfolio-add-btn {
            background: var(--accent-neutral);
            color: white;
            border: none;
            padding: 0.6rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        .portfolio-add-btn:hover {
            background: #2563eb;
        }

        .timeframe-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .timeframe-btn {
            padding: 0.6rem 1.2rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
        }

        .timeframe-btn:hover {
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .timeframe-btn.active {
            background: var(--accent-neutral);
            border-color: var(--accent-neutral);
            color: white;
        }

        /* Grid Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s;
            position: relative;
        }

        .metric-card:hover {
            border-color: var(--accent-neutral);
            transform: translateY(-2px);
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .metric-change {
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .positive {
            color: var(--accent-bullish);
        }

        .negative {
            color: var(--accent-bearish);
        }

        /* Chart Container */
        .chart-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            position: relative;
            height: 350px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .chart-controls {
            display: flex;
            gap: 0.5rem;
        }

        .control-btn {
            padding: 0.5rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .control-btn:hover {
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .control-btn.active {
            background: var(--accent-neutral);
            border-color: var(--accent-neutral);
            color: white;
        }

        /* Sentiment Widget */
        .sentiment-widget {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .sentiment-score {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
        }

        .score-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(59, 130, 246, 0.2));
            border: 3px solid var(--accent-bullish);
        }

        .sentiment-breakdown {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .sentiment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sentiment-bar {
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .sentiment-fill {
            height: 100%;
            transition: width 0.5s;
        }

        /* --- NEW PORTFOLIO SECTION --- */
        .portfolio-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .portfolio-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .portfolio-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .summary-card {
            background: var(--bg-tertiary);
            padding: 1.5rem;
            border-radius: 8px;
        }

        .summary-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .summary-value {
            font-size: 1.75rem;
            font-weight: 700;
        }

        .portfolio-table-container {
            width: 100%;
            overflow-x: auto;
        }

        .portfolio-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .portfolio-table th,
        .portfolio-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .portfolio-table th {
            color: var(--text-secondary);
            font-size: 0.85rem;
            text-transform: uppercase;
        }

        .portfolio-table td {
            font-size: 0.95rem;
        }

        .symbol-name {
            font-weight: 600;
        }

        .symbol-sub {
            font-size: 0.85rem;
            color: var(--text-secondary);
            display: block;
        }

        .remove-stock-btn {
            background: rgba(239, 68, 68, 0.1);
            color: var(--accent-bearish);
            border: none;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .remove-stock-btn:hover {
            background: var(--accent-bearish);
            color: white;
        }

        /* --- NEW MODAL STYLES --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1010;
            display: none;
            /* Hidden by default */
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .modal-close {
            font-size: 1.75rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: var(--text-primary);
        }

        .modal-body {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--accent-neutral);
        }

        .modal-footer {
            margin-top: 1.5rem;
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }

        .modal-btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-btn-primary {
            background: var(--accent-neutral);
            color: white;
        }

        .modal-btn-primary:hover {
            background: #2563eb;
        }

        .modal-btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        .modal-btn-secondary:hover {
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        /* News Section (Original) */
        .news-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .news-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .news-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            gap: 1rem;
        }

        .news-item:last-child {
            border-bottom: none;
        }

        .news-item:hover {
            background: var(--bg-tertiary);
        }

        .news-sentiment-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .news-content {
            flex: 1;
        }

        .news-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .news-meta {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Chatbot */
        .chatbot-trigger {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--accent-neutral), var(--accent-bullish));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
            transition: transform 0.3s;
            z-index: 1001;
        }

        .chatbot-trigger:hover {
            transform: scale(1.1);
        }

        .chatbot-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 400px;
            height: 600px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            display: none;
            flex-direction: column;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            z-index: 1002;
        }

        .chatbot-container.active {
            display: flex;
        }

        .chatbot-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chatbot-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .chatbot-close {
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--text-secondary);
            transition: color 0.3s;
        }

        .chatbot-close:hover {
            color: var(--text-primary);
        }

        .chatbot-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .chat-message {
            display: flex;
            gap: 0.75rem;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 1.2rem;
        }

        .bot-avatar {
            background: linear-gradient(135deg, var(--accent-neutral), var(--accent-bullish));
        }

        .user-avatar {
            background: var(--bg-tertiary);
        }

        .message-content {
            flex: 1;
            padding: 1rem;
            border-radius: 12px;
            background: var(--bg-tertiary);
        }

        .chat-message.user .message-content {
            background: var(--accent-neutral);
        }

        .chatbot-input-area {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 0.75rem;
        }

        .chatbot-input {
            flex: 1;
            padding: 0.75rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .chatbot-input:focus {
            outline: none;
            border-color: var(--accent-neutral);
        }

        .chatbot-send {
            padding: 0.75rem 1.5rem;
            background: var(--accent-neutral);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .chatbot-send:hover {
            background: #2563eb;
        }

        /* Footer */
        .footer {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 2rem;
            text-align: center;
            /* --- margin-left REMOVED --- */
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .disclaimer {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }

        .data-sources {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        /* Loading States */
        .skeleton {
            background: linear-gradient(90deg, var(--bg-tertiary) 25%, var(--bg-secondary) 50%, var(--bg-tertiary) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 8px;
        }

        @keyframes loading {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            /* --- SIDEBAR RULES REMOVED --- */

            .dashboard-grid {
                grid-template-columns: 1fr 1fr;
            }

            .chart-section {
                grid-template-columns: 1fr;
            }

            .chatbot-container {
                width: calc(100vw - 2rem);
                height: calc(100vh - 2rem);
                bottom: 1rem;
                right: 1rem;
            }
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="logo">FinAI Pro</div>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search stocks (e.g., AAPL, MSFT, TSLA)...">
            <div class="autocomplete" id="autocomplete"></div>
        </div>
        <div class="header-actions">
            <button class="icon-btn" id="themeToggle" title="Toggle Theme">ðŸŒ™</button>
            <button class="icon-btn" id="notificationBtn" title="Notifications">ðŸ””</button>
            <button class="icon-btn" title="User Profile">ðŸ‘¤</button>
        </div>
    </header>

    <main class="main-content" id="mainContent">
        <div class="stock-banner">
            <div class="stock-info-main">
                <div class="stock-info">
                    <div class="stock-symbol">AAPL</div>
                    <div class="stock-price">$178.25</div>
                    <div class="stock-change">+2.45 (+1.39%)</div>
                </div>
                <button class="portfolio-add-btn" id="openPortfolioModalBtn">
                    + Add to Portfolio
                </button>
            </div>
            <div class="timeframe-buttons">
                <button class="timeframe-btn">1D</button>
                <button class="timeframe-btn active">1W</button>
                <button class="timeframe-btn">1M</button>
                <button class="timeframe-btn">3M</button>
                <button class="timeframe-btn">1Y</button>
                <button class="timeframe-btn">5Y</button>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="metric-card">
                <div class="metric-label">Market Cap</div>
                <div class="metric-value">$2.78T</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">P/E Ratio</div>
                <div class="metric-value">29.45</div>
                <div class="metric-change positive">â†‘ Healthy</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">EPS (TTM)</div>
                <div class="metric-value">$6.05</div>
                <div class="metric-change positive">â†‘ +8.2%</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Volume</div>
                <div class="metric-value">52.4M</div>
                <div class="metric-change">Avg: 58.3M</div>
            </div>
        </div>

        <div class="chart-section">
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">Price Chart</div>
                    <div class="chart-controls">
                        <button class="control-btn active">MA10</button>
                        <button class="control-btn">MA50</button>
                        <button class="control-btn">MA200</button>
                        <button class="control-btn">Volume</button>
                    </div>
                </div>
                <canvas id="priceChart" height="300"></canvas>
            </div>

            <div class="sentiment-widget">
                <div class="chart-title">Market Sentiment</div>
                <div class="sentiment-score">
                    <div class="score-circle">72</div>
                </div>
                <div class="sentiment-breakdown">
                    <div class="sentiment-item">
                        <span>Bullish</span>
                        <span style="color: var(--accent-bullish);">65%</span>
                    </div>
                    <div class="sentiment-bar">
                        <div class="sentiment-fill" style="width: 65%; background: var(--accent-bullish);"></div>
                    </div>
                    <div class="sentiment-item">
                        <span>Neutral</span>
                        <span style="color: var(--accent-neutral);">25%</span>
                    </div>
                    <div class="sentiment-bar">
                        <div class="sentiment-fill" style="width: 25%; background: var(--accent-neutral);"></div>
                    </div>
                    <div class="sentiment-item">
                        <span>Bearish</span>
                        <span style="color: var(--accent-bearish);">10%</span>
                    </div>
                    <div class="sentiment-bar">
                        <div class="sentiment-fill" style="width: 10%; background: var(--accent-bearish);"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="portfolio-section">
            <div class="portfolio-header">
                <div class="chart-title">My Portfolio</div>
            </div>

            <div class="portfolio-summary">
                <div class="summary-card">
                    <div class="summary-label">Total Value</div>
                    <div class="summary-value" id="portfolioTotalValue">$0.00</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Total Cost</div>
                    <div class="summary-value" id="portfolioTotalCost">$0.00</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">Total Gain / Loss</div>
                    <div class="summary-value positive" id="portfolioTotalGainLoss">$0.00</div>
                </div>
            </div>

            <div class="portfolio-table-container">
                <table class="portfolio-table">
                    <thead>
                        <tr>
                            <th>Stock</th>
                            <th>Shares</th>
                            <th>Avg. Cost</th>
                            <th>Current Price</th>
                            <th>Total Cost</th>
                            <th>Current Value</th>
                            <th>Gain / Loss</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="portfolioTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <div class="news-section">
            <div class="news-header">
                <div class="chart-title">Latest News</div>
                <button class="control-btn">View All</button>
            </div>
            <div class="news-item">
            </div>
        </div>
    </main>

    <div class="chatbot-trigger" id="chatbotTrigger">
        ðŸ’¬
    </div>

    <div class="chatbot-container" id="chatbotContainer">
    </div>

    <div class="modal-overlay" id="addStockModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Add Stock to Portfolio</h3>
                <span class="modal-close" id="closePortfolioModalBtn">Ã—</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="modalStockSymbol">Stock Symbol</label>
                    <input type="text" id="modalStockSymbol" readonly>
                </div>
                <div class="form-group">
                    <label for="modalStockShares">Number of Shares</label>
                    <input type="number" id="modalStockShares" placeholder="e.g., 10">
                </div>
                <div class="form-group">
                    <label for="modalStockPrice">Purchase Price ($)</label>
                    <input type="number" id="modalStockPrice" placeholder="e.g., 175.50">
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-secondary" id="cancelStockAddBtn">Cancel</button>
                <button class="modal-btn modal-btn-primary" id="confirmStockAddBtn">Add Stock</button>
            </div>
        </div>
    </div>


    <footer class="footer" id="footer">
    </footer>

    <script>
        // Wait for DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function () {

            // --- NEW: EXPANDED GLOBAL DATA ---
            const stockData = {
                AAPL: { name: 'Apple Inc.', price: 271.40, change: 1.70, changePercent: 0.63 },
                MSFT: { name: 'Microsoft Corp.', price: 525.76, change: -15.79, changePercent: -2.91 },
                GOOGL: { name: 'Alphabet Inc. (Google)', price: 281.48, change: 6.91, changePercent: 2.51 },
                AMZN: { name: 'Amazon.com Inc.', price: 222.86, change: -7.44, changePercent: -3.23 },
                NVDA: { name: 'NVIDIA Corp.', price: 202.89, change: -4.15, changePercent: -2.00 },
                TSLA: { name: 'Tesla Inc.', price: 440.10, change: -21.41, changePercent: -4.63 },
                META: { name: 'Meta Platforms', price: 666.47, change: -85.20, changePercent: -11.33 },
                JPM: { name: 'JPMorgan Chase', price: 309.44, change: 3.93, changePercent: 1.28 },
                V: { name: 'Visa Inc.', price: 345.03, change: 3.75, changePercent: 1.09 },
                WMT: { name: 'Walmart Inc.', price: 102.23, change: -0.23, changePercent: -0.22 },
                JNJ: { name: 'Johnson & Johnson', price: 189.05, change: 2.45, changePercent: 1.31 },
                NFLX: { name: 'Netflix, Inc.', price: 1089.00, change: -11.41, changePercent: -1.03 },
                COST: { name: 'Costco Wholesale', price: 920.18, change: 7.76, changePercent: 0.85 },
                AMD: { name: 'Advanced Micro Devices', price: 254.84, change: -9.49, changePercent: -3.59 },
                DIS: { name: 'Walt Disney Co.', price: 111.47, change: -0.65, changePercent: -0.58 }
            };

            // --- Load portfolio from localStorage or initialize as empty array
            let portfolio = JSON.parse(localStorage.getItem('myPortfolio')) || [];


            // --- Autocomplete ---
            const searchInput = document.getElementById('searchInput');
            const autocomplete = document.getElementById('autocomplete');

            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toUpperCase();
                if (query.length > 0) {
                    const matches = Object.keys(stockData).filter(symbol =>
                        symbol.includes(query) || stockData[symbol].name.toUpperCase().includes(query)
                    );

                    if (matches.length > 0) {
                        autocomplete.innerHTML = matches.map(symbol => `
                        <div class="autocomplete-item" data-symbol="${symbol}">
                            <strong>${symbol}</strong> - ${stockData[symbol].name}
                        </div>
                    `).join('');
                        autocomplete.classList.add('active');
                    } else {
                        autocomplete.classList.remove('active');
                    }
                } else {
                    autocomplete.classList.remove('active');
                }
            });

            autocomplete.addEventListener('click', (e) => {
                const item = e.target.closest('.autocomplete-item');
                if (item) {
                    const symbol = item.dataset.symbol;
                    loadStock(symbol);
                    searchInput.value = '';
                    autocomplete.classList.remove('active');
                }
            });

            document.addEventListener('click', (e) => {
                if (!searchInput.contains(e.target) && !autocomplete.contains(e.target)) {
                    autocomplete.classList.remove('active');
                }
            });

            // --- Load stock data ---
            function loadStock(symbol) {
                // Default to AAPL if the symbol doesn't exist for some reason
                if (!stockData[symbol]) {
                    symbol = 'AAPL';
                }

                const stock = stockData[symbol];
                if (!stock) return;

                const isPositive = stock.change > 0;
                document.querySelector('.stock-symbol').textContent = symbol;
                document.querySelector('.stock-price').textContent = `$${stock.price.toFixed(2)}`;
                document.querySelector('.stock-change').textContent =
                    `${isPositive ? '+' : ''}${stock.change.toFixed(2)} (${isPositive ? '+' : ''}${stock.changePercent.toFixed(2)}%)`;

                const changeEl = document.querySelector('.stock-change');
                const priceEl = document.querySelector('.stock-price');

                changeEl.style.background = isPositive ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)';
                changeEl.style.color = isPositive ? 'var(--accent-bullish)' : 'var(--accent-bearish)';
                priceEl.style.color = isPositive ? 'var(--accent-bullish)' : 'var(--accent-bearish)';

                // Update chart (demo data)
                // In a real app, you'd fetch new chart data here
                const newData = Array.from({ length: 7 }, () => stock.price * (1 + (Math.random() - 0.5) * 0.1));
                newData[6] = stock.price; // Ensure last point is the current price
                priceChart.data.datasets[0].data = newData;
                priceChart.data.datasets[0].borderColor = isPositive ? 'var(--accent-bullish)' : 'var(--accent-bearish)';
                priceChart.data.datasets[0].backgroundColor = isPositive ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)';
                priceChart.update();
            }

            // Timeframe buttons
            document.querySelectorAll('.timeframe-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.timeframe-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                });
            });

            // Chart controls
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    btn.classList.toggle('active');
                });
            });

            // --- Chart.js initialization ---
            const ctx = document.getElementById('priceChart').getContext('2d');
            const priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Price',
                        data: [268.5, 270.2, 271.8, 269.9, 270.4, 271.1, 271.40],
                        borderColor: 'var(--accent-bullish)',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { grid: { color: '#2d3548' }, ticks: { color: '#9ca3af' } },
                        x: { grid: { color: '#2d3548' }, ticks: { color: '#9ca3af' } }
                    }
                }
            });


            // --- PORTFOLIO MODAL LOGIC ---
            const addStockModal = document.getElementById('addStockModal');
            const openModalBtn = document.getElementById('openPortfolioModalBtn');
            const closeModalBtn = document.getElementById('closePortfolioModalBtn');
            const cancelModalBtn = document.getElementById('cancelStockAddBtn');
            const confirmAddBtn = document.getElementById('confirmStockAddBtn');

            const modalSymbol = document.getElementById('modalStockSymbol');
            const modalShares = document.getElementById('modalStockShares');
            const modalPrice = document.getElementById('modalStockPrice');

            function openModal() {
                const currentSymbol = document.querySelector('.stock-symbol').textContent;
                const currentPrice = stockData[currentSymbol].price;

                modalSymbol.value = currentSymbol;
                modalPrice.value = currentPrice.toFixed(2); // Pre-fill price
                modalShares.value = ''; // Clear shares
                modalShares.focus();

                addStockModal.classList.add('active');
            }

            function closeModal() {
                addStockModal.classList.remove('active');
            }

            openModalBtn.addEventListener('click', openModal);
            closeModalBtn.addEventListener('click', closeModal);
            cancelModalBtn.addEventListener('click', closeModal);

            addStockModal.addEventListener('click', (e) => {
                if (e.target === addStockModal) {
                    closeModal();
                }
            });

            confirmAddBtn.addEventListener('click', addStockToPortfolio);


            // --- PORTFOLIO MANAGEMENT FUNCTIONS ---

            function addStockToPortfolio() {
                const symbol = modalSymbol.value;
                const shares = parseFloat(modalShares.value);
                const purchasePrice = parseFloat(modalPrice.value);

                if (!symbol || isNaN(shares) || isNaN(purchasePrice) || shares <= 0 || purchasePrice <= 0) {
                    alert('Please enter valid shares and price.');
                    return;
                }

                const existingStock = portfolio.find(stock => stock.symbol === symbol);

                if (existingStock) {
                    const totalCost = (existingStock.avgCost * existingStock.shares) + (purchasePrice * shares);
                    const totalShares = existingStock.shares + shares;
                    existingStock.avgCost = totalCost / totalShares;
                    existingStock.shares = totalShares;
                } else {
                    portfolio.push({
                        symbol: symbol,
                        shares: shares,
                        avgCost: purchasePrice
                    });
                }

                savePortfolio();
                renderPortfolio();
                closeModal();
            }

            function removeStockFromPortfolio(symbolToRemove) {
                portfolio = portfolio.filter(stock => stock.symbol !== symbolToRemove);
                savePortfolio();
                renderPortfolio();
            }

            function savePortfolio() {
                localStorage.setItem('myPortfolio', JSON.stringify(portfolio));
            }

            function formatCurrency(value) {
                return value.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
            }

            function renderPortfolio() {
                const tableBody = document.getElementById('portfolioTableBody');
                const totalValueEl = document.getElementById('portfolioTotalValue');
                const totalCostEl = document.getElementById('portfolioTotalCost');
                const totalGainLossEl = document.getElementById('portfolioTotalGainLoss');

                tableBody.innerHTML = '';

                let portfolioTotalValue = 0;
                let portfolioTotalCost = 0;

                if (portfolio.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--text-secondary);">Your portfolio is empty. Add stocks to get started.</td></tr>';
                }

                portfolio.forEach(stock => {
                    const stockInfo = stockData[stock.symbol];
                    if (!stockInfo) {
                        console.warn(`No data for symbol ${stock.symbol} in portfolio. It may have been removed.`);
                        // Optionally, you could add a row indicating the data is missing
                        return;
                    }

                    const currentPrice = stockInfo.price;
                    const totalCost = stock.shares * stock.avgCost;
                    const currentValue = stock.shares * currentPrice;
                    const gainLoss = currentValue - totalCost;
                    const gainLossPercent = totalCost === 0 ? 0 : (gainLoss / totalCost) * 100;

                    const isPositive = gainLoss >= 0;

                    portfolioTotalValue += currentValue;
                    portfolioTotalCost += totalCost;

                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <span class="symbol-name">${stock.symbol}</span>
                            <span class="symbol-sub">${stockInfo.name}</span>
                        </td>
                        <td>${stock.shares}</td>
                        <td>${formatCurrency(stock.avgCost)}</td>
                        <td>${formatCurrency(currentPrice)}</td>
                        <td>${formatCurrency(totalCost)}</td>
                        <td>${formatCurrency(currentValue)}</td>
                        <td style="color: ${isPositive ? 'var(--accent-bullish)' : 'var(--accent-bearish)'};">
                            ${formatCurrency(gainLoss)}
                            <span style="font-size: 0.85rem; display: block;">(${isPositive ? '+' : ''}${gainLossPercent.toFixed(2)}%)</span>
                        </td>
                        <td>
                            <button class="remove-stock-btn" data-symbol="${stock.symbol}">Remove</button>
                        </td>
                    `;

                    row.querySelector('.remove-stock-btn').addEventListener('click', (e) => {
                        const symbol = e.target.getAttribute('data-symbol');
                        if (confirm(`Are you sure you want to remove ${symbol} from your portfolio?`)) {
                            removeStockFromPortfolio(symbol);
                        }
                    });

                    tableBody.appendChild(row);
                });

                // Update totals
                const portfolioTotalGainLoss = portfolioTotalValue - portfolioTotalCost;
                totalValueEl.textContent = formatCurrency(portfolioTotalValue);
                totalCostEl.textContent = formatCurrency(portfolioTotalCost);
                totalGainLossEl.textContent = formatCurrency(portfolioTotalGainLoss);

                if (portfolioTotalGainLoss >= 0) {
                    totalGainLossEl.style.color = 'var(--accent-bullish)';
                } else {
                    totalGainLossEl.style.color = 'var(--accent-bearish)';
                }
            }

            // Initial load of default stock (AAPL)
            loadStock('AAPL');

            // Initial render on page load
            renderPortfolio();


            // --- Chatbot functionality ---
            const chatbotTrigger = document.getElementById('chatbotTrigger');
            const chatbotContainer = document.getElementById('chatbotContainer');
            const chatbotClose = document.getElementById('chatbotClose');
            const chatbotMessages = document.getElementById('chatbotMessages');
            const chatbotInput = document.getElementById('chatbotInput');
            const chatbotSend = document.getElementById('chatbotSend');

            chatbotTrigger.addEventListener('click', () => {
                chatbotContainer.classList.add('active');
                chatbotTrigger.style.display = 'none';
            });

            chatbotClose.addEventListener('click', () => {
                chatbotContainer.classList.remove('active');
                chatbotTrigger.style.display = 'flex';
            });

            function addMessage(text, isUser = false) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `chat-message ${isUser ? 'user' : ''}`;
                messageDiv.innerHTML = `
                <div class="message-avatar ${isUser ? 'user-avatar' : 'bot-avatar'}">
                    ${isUser ? 'ðŸ‘¤' : 'ðŸ¤–'}
                </div>
                <div class="message-content">${text}</div>
            `;
                chatbotMessages.appendChild(messageDiv);
                chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
            }

            function getBotResponse(userMessage) {
                const msg = userMessage.toLowerCase();

                // Stock price queries
                if (msg.includes('price') || msg.includes('worth') || msg.includes('trading at')) {
                    const symbols = Object.keys(stockData);
                    for (let symbol of symbols) {
                        if (msg.includes(symbol.toLowerCase()) || stockData[symbol].name.toLowerCase().includes(msg)) {
                            const stock = stockData[symbol];
                            return `${symbol} (${stock.name}) is currently trading at ${stock.price.toFixed(2)}, ${stock.change > 0 ? 'up' : 'down'} ${Math.abs(stock.changePercent).toFixed(2)}% today.`;
                        }
                    }
                }

                // --- Updated chatbot responses ---
                if (msg.includes('p/e') || msg.includes('pe ratio')) {
                    return "The P/E (Price-to-Earnings) ratio measures a company's stock price relative to its earnings per share. A high P/E can mean a stock is overvalued, or that investors expect high growth. A low P/E can mean it's undervalued, or that the company has problems.";
                }
                if (msg.includes('eps') || msg.includes('earnings per share')) {
                    return "EPS (Earnings Per Share) is a company's profit divided by its number of stock shares. It's a key indicator of profitability. Higher EPS is generally better.";
                }
                if (msg.includes('market cap')) {
                    return "Market capitalization is the total value of all a company's shares of stock. It's calculated by multiplying the stock price by the total number of outstanding shares.";
                }
                if (msg.includes('should i buy') || msg.includes('invest')) {
                    return "As an AI, I cannot give financial advice. This platform is a demo and does not use real-time data. You should always do your own research and consult a financial professional before investing.";
                }
                if (msg.includes('portfolio') || msg.includes('my stocks')) {
                    return "You can add the currently viewed stock to your portfolio using the '+ Add to Portfolio' button. Your portfolio is saved in your browser and will be waiting for you when you return!";
                }

                // Default response
                const responses = [
                    "I can help with stock analysis, financial metrics, and market trends. Try asking about 'P/E ratio', 'EPS', or the price of 'TSLA'.",
                    "I'm here to assist with your research. You can ask me to explain financial terms or look up stock prices from my demo database.",
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            function sendMessage() {
                const message = chatbotInput.value.trim();
                if (message) {
                    addMessage(message, true);
                    chatbotInput.value = '';

                    setTimeout(() => {
                        const response = getBotResponse(message);
                        addMessage(response);
                    }, 500);
                }
            }

            chatbotSend.addEventListener('click', sendMessage);
            chatbotInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // Update timestamp
            function updateTimestamp() {
                const now = new Date();
                const timestampEl = document.getElementById('lastUpdated');
                if (timestampEl) {
                    timestampEl.textContent = now.toLocaleString();
                }
            }
            updateTimestamp();
            setInterval(updateTimestamp, 60000);

            // Theme toggle (placeholder)
            document.getElementById('themeToggle').addEventListener('click', function () {
                alert('Light theme coming soon! ðŸŒž');
            });

        }); // End of DOMContentLoaded
    </script>
</body>

</html>
